{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Purchases",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Purchases": {
      "main": [
        [
          {
            "node": "Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Database": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sheet": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "Purchases1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Database1": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Purchases1": {
      "main": [
        [
          {
            "node": "Database1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "Sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sheet1": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-17T14:15:58.543Z",
  "id": "NHEPrb3EBBuehgOn",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Busca deals não encontradas",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        0,
        0
      ],
      "id": "2cc4ffb4-a7ee-485b-a141-9a6d55004502",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        416,
        0
      ],
      "id": "26f27c4e-4316-4f5a-84dc-c5b48af7edea",
      "name": "Database"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "purchases_new",
          "mode": "list",
          "cachedResultName": "purchases_new"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "launch_tag",
              "value": "SSP-L19"
            },
            {
              "column": "status",
              "value": "approved"
            },
            {
              "column": "offer_id",
              "value": "193"
            }
          ]
        },
        "options": {
          "outputColumns": [
            "ext_id",
            "id_transaction"
          ]
        }
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        208,
        0
      ],
      "id": "70b69bc9-f980-46d4-89a1-b4245c3fdb55",
      "name": "Purchases",
      "credentials": {
        "mySql": {
          "id": "SLbk0R6796E4DmlD",
          "name": "MySQL infoproduct"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1QX0F4DY9LV1XKeMuwFL_r3msvn4D-3Ue16OSkPH5WRg/edit",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 655182298,
          "mode": "list",
          "cachedResultName": "sales_history_20251217141437_87B4CC1812827744579765940286",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1QX0F4DY9LV1XKeMuwFL_r3msvn4D-3Ue16OSkPH5WRg/edit#gid=655182298"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        624,
        0
      ],
      "id": "84f4e624-db05-42c5-bf4f-2d7b1c397e5e",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "SN6RzeMl3gN9prB4",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        832,
        0
      ],
      "id": "fe9d2918-7dc2-4eca-87b5-17f59262a1dc",
      "name": "Sheet"
    },
    {
      "parameters": {
        "jsCode": "const db = $node['Database'].json.data;\nconst sheet = $node['Sheet'].json.data;\n\n// Sets normalizados\nconst dbSet = new Set(db.map(d => d.ext_id).filter(Boolean));\nconst sheetSet = new Set(\n  sheet.map(s => s[\"Código da transação\"]).filter(Boolean)\n);\n\n// união total (sheet + db)\nconst allIds = new Set([\n  ...dbSet,\n  ...sheetSet\n]);\n\n// comparação final\nconst result = Array.from(allIds).map(id => ({\n  id,\n  found: dbSet.has(id) && sheetSet.has(id)\n}));\n\nreturn result;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        0
      ],
      "id": "ed48c0b1-7e43-4849-a85e-a28078aed7cd",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.found }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "94f8531e-5e84-4dc8-acdd-975c8819e80c"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "TRUE"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a31027bc-d63c-43e1-9c75-8f6543c45af3",
                    "leftValue": "={{ $json.found }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "false",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "FALSE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1248,
        0
      ],
      "id": "f49cf777-6ad6-4628-a4cd-924e96853b1d",
      "name": "Switch"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        0,
        208
      ],
      "id": "d5a3ee87-7844-4bad-bd91-4074a26700c5",
      "name": "Schedule Trigger1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        416,
        208
      ],
      "id": "d77bd22f-9c60-4a20-928f-e928689d22c6",
      "name": "Database1"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "purchases_new",
          "mode": "list",
          "cachedResultName": "purchases_new"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "launch_tag",
              "value": "SSP-L19"
            },
            {
              "column": "status",
              "value": "approved"
            },
            {
              "column": "offer_id",
              "value": "192"
            }
          ]
        },
        "options": {
          "outputColumns": [
            "ext_id",
            "id_transaction"
          ]
        }
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        208,
        208
      ],
      "id": "c8c0df87-f3bd-49c8-8a75-63100c679d2e",
      "name": "Purchases1",
      "credentials": {
        "mySql": {
          "id": "SLbk0R6796E4DmlD",
          "name": "MySQL infoproduct"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1QX0F4DY9LV1XKeMuwFL_r3msvn4D-3Ue16OSkPH5WRg/edit",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1395779707,
          "mode": "list",
          "cachedResultName": "guru-Vendas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1QX0F4DY9LV1XKeMuwFL_r3msvn4D-3Ue16OSkPH5WRg/edit#gid=1395779707"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        624,
        208
      ],
      "id": "12e1916c-ab75-4161-84a3-b2dfda7ea835",
      "name": "Get row(s) in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "SN6RzeMl3gN9prB4",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        832,
        208
      ],
      "id": "12ea6a96-75c5-47a8-a261-603f5d6dd25f",
      "name": "Sheet1"
    },
    {
      "parameters": {
        "jsCode": "const db = $node['Database1'].json.data;\nconst sheet = $node['Sheet1'].json.data;\n\n// Sets normalizados\nconst dbSet = new Set(db.map(d => d.ext_id).filter(Boolean));\nconst sheetSet = new Set(\n  sheet.map(s => s[\"id transação\"]).filter(Boolean)\n);\n\n// união total (sheet + db)\nconst allIds = new Set([\n  ...dbSet,\n  ...sheetSet\n]);\n\n// comparação final\nconst result = Array.from(allIds).map(id => ({\n  id,\n  found: dbSet.has(id) && sheetSet.has(id)\n}));\n\nreturn result;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        208
      ],
      "id": "34bbc58e-85de-4e49-86a3-197a4cb1c255",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.found }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "94f8531e-5e84-4dc8-acdd-975c8819e80c"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "TRUE"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a31027bc-d63c-43e1-9c75-8f6543c45af3",
                    "leftValue": "={{ $json.found }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "false",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "FALSE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1248,
        208
      ],
      "id": "6b5a3cbd-f92c-4a8e-93cf-a8873ae3b103",
      "name": "Switch1"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-12-17T14:15:58.543Z",
      "createdAt": "2025-12-17T14:15:58.543Z",
      "role": "workflow:owner",
      "workflowId": "NHEPrb3EBBuehgOn",
      "projectId": "VuiAAhWq61ItL83O"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-12-17T14:51:51.592Z",
  "versionId": "a0cdbc6e-5918-481f-ab7a-f5a66d3b900f"
}